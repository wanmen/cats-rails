<% content_for :head do %>
   <title><%= @list.title %> | 万门大学</title>
<% end %>
<main class="container" role="main">
  <article class="col-sm-8">
    <h3 class="page-header">
      <span class="wm-title"><%= @list.title %></span>
      <span class="wm-quick-link">
        <a href="/lists/<%=@list.id %>/edit">修改</a> |
        <a href="JavaScript:window.history.back();">返回</a>
      </span>
    </h3>
    <p class="wm-pub-metadata">
      <a href="/scholars/<%=@list.user[:id]%>"><%= @list.user[:name] %></a> 发布于 
      <%= @list[:updated_at].strftime('%b %d, %Y %H:%M')  %>
      <span class="pull-right"><%= @list.taglinks.length %> 个标签 | <%= @list.likes.length %>人喜欢 | <%= @list.comments.length%>个评论</span>
    </p>
    <section class="wm-indent">
      <%= @list.summary %>
    </section>

    <section class="wm-book-list wm-book-gallery">
      <% @list.links.each do |link| %>
        <div class="row wm-list-item">
          <figure class="col-sm-4">
            <a href="/<%= @type %>/<%=link.linkable.id %>.html" class="thumbnail">
               <img src="<%= link.linkable.cover %>!medium" alt="" title="<%=link.linkable.title%>">
            </a>
          </figure>
          <div class="col-sm-8">
            <h4><a href="/<%= @type %>/<%=link.linkable.id %>.html"><%=link.linkable.title%></a></h4>
            <p>
              <%= link.order_num %>
            </p>
            <p>
              <%= link.description %>
            </p>
            <p> <a href="/links/<%= link.id%>/edit">修改描述或顺序</a></p>
          </div>
        </div>
        <hr/>
      <% end %>
    </section>

    <section class="wm-indent">
      <%= @list.summary %>
    </section>

    <section class="wm-metadata">
      <div>   
      <%= render :partial => 'taglinks/taglinks' %>
      <%= render :partial => 'taglinks/form' %>
      <%= render :partial => 'likes/likes' %>
      <%= render :partial => 'likes/form' %>
      <%= render :partial => 'rates/rates' %>
      <%= render :partial => 'rates/form' %> 
      </div>
    </section>

    <hr/>

    <section id="sns_share">
      <div class="wm-sns-share">
        <span class="text-muted">分享到</span>
        <img src="/assets/sns/renren.png" height="24" alt="人人" title="分享到人人"/>
        <img src="/assets/sns/douban.png" height="24" alt="豆瓣" title="分享到豆瓣"/>
        <img src="/assets/sns/sina.png" height="24" alt="新浪微博" title="分享到新浪微博"/>
        <img src="/assets/sns/qzone.png" height="24" alt="QQ空间" title="分享到QQ空间"/>
        <img src="/assets/sns/tencent.png" height="24" alt="腾讯微博" title="分享到腾讯微博"/>
        <a class="btn btn-primary btn-sm wm-quick-link" href="#edit_comments">发表评论</a>
      </div>
    </section>

    
    <%= render :partial => 'comments/comments' %>
    <%= render :partial => 'comments/form' %>
  </article>

  <aside class="col-sm-4">
    <section class="wm-recommend">
      <h3 class="page-header">
        <span class="glyphicon glyphicon-plus-sign"></span> 同主题推荐
        <a class="wm-quick-link" href="">查看全部</a>
      </h3>
      <div class="row">
        <figure class="col-sm-6">
          <a class="thumbnail" href="">
            <img src="http://img.wanmen.org/2013/09/5c4c8a8a674fa4be2f7374344f95a4aa.jpg" alt="" title="苏联遗传学劫难"/>
          </a>
          <figcaption>
            <a href="" title="苏联遗传学劫难">苏联遗传学劫难</a>
          </figcaption>
        </figure>
        <figure class="col-sm-6">
          <a class="thumbnail" href="">
            <img src="http://img.wanmen.org/2013/09/24dc33387b1c0ca121f5f7a8e4f8cfe4.jpg" alt="" title="人类基因的历史地图"/>
          </a>
          <figcaption>
            <a href="" title="人类基因的历史地图">人类基因的历史地图</a>
          </figcaption>
        </figure>
      </div>
      <div class="row">
        <figure class="col-sm-6">
          <a class="thumbnail" href="">
            <img src="http://img.wanmen.org/2013/09/adeb1e84045dbd4bcf398a71c887fa75.jpg" alt="" title="玻利维亚日记"/>
          </a>
          <figcaption>
            <a href="" title="玻利维亚日记">玻利维亚日记</a>
          </figcaption>
        </figure>
        <figure class="col-sm-6">
          <a class="thumbnail" href="">
            <img src="http://img.wanmen.org/2013/09/5537418d7e0b069154b597513189781b.jpg" alt=""/>
          </a>
          <figcaption>
            <a href="" title="学术与政治学术">学术与政治学术</a>
          </figcaption>
        </figure>
      </div>
    </section>
  </aside>
</main>
<script src="/assets/jquery.js"></script>
<script src="/assets/bootstrap.js"></script>
<script src="/assets/wm-dom.js"></script>
<script src="/assets/Markdown.Converter.js"></script>
<script src="/assets/Markdown.Sanitizer.js"></script>
<script src="/assets/Markdown.Editor.js"></script>
<script src="/assets/Markdown.Extra.js"></script>
<script src="/assets/Markdown.local.zh.js"></script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    showProcessingMessages: false,
    tex2jax: {inlineMath: [["$", "$"], ["\\(", "\\)"]]}
  });
</script>
<script type="text/javascript">
  (function() {
    var QUEUE = MathJax.Hub.queue,
      math = null;

    QUEUE.Push(function() {
      math = MathJax.Hub.getAllJax('#wmd-preview')[0];
    });

    window.UpdateMath = function(TeX) {
      $('wmd-preview').html(TeX);
      MathJax.Hub.Queue(['Typeset', math, 'wmd-preview']);
    }

    $('#wmd-input').keypress(function(event) {
      UpdateMath($(this).val());
    });

  })();
</script>
<script type="text/javascript">
  (function () {
    var converter = Markdown.getSanitizingConverter();
    converter.hooks.chain('preBlockGamut', function(text, rbg) {
      return text.replace(/^ {0,3}""" *\n((?:.*?\n)+?) {0,3}""" *$/gm,
        function (whole, inner) {
          return "<blockquote>" + rbg(inner) + '</blockquote>\n';
      });
    });

    var editor = new Markdown.Editor(converter, null, {strings: Markdown.local.zh});
    editor.run();
  })();
</script>
<script src="/assets/jquery.raty.js"></script>
<script>
    $(document).ready(function() {
      $('#rate_button').hide();
      $('#star').raty({
        score: function() {
          return $(this).attr('data-score');
        },
        click: function(score, evt) {
          $('#rate')[0].value = score;
          $('#rate_button').show();
        }
      });
    });
    function addTag(){
      $('#tagForm').show();
    }
    function hideTag(){
      $('#tagForm').hide();
    }
    function addList(){
      $('#listForm').show();
    }
    function hideList(){
      $('#listForm').hide();
    }
</script>
